### **Ejercicio Pr√°ctico: Tu Primera Infraestructura con Terraform en AWS**

#### **üéØ Objetivo del Ejercicio**

Poner en pr√°ctica los conceptos fundamentales de Terraform para crear una infraestructura real en la nube. Al finalizar, habr√°s aprendido a:
1.  Inicializar un proyecto de Terraform.
2.  Declarar y configurar un proveedor (AWS).
3.  Utilizar **variables de entrada** para hacer el c√≥digo flexible (regi√≥n, tipo de instancia, etc.).
4.  Definir y crear un recurso (una instancia EC2 de AWS).
5.  Exponer informaci√≥n √∫til mediante **variables de salida** (la IP p√∫blica de la m√°quina).
6.  Seguir el flujo de trabajo est√°ndar: `init`, `plan`, `apply` y `destroy`.

---

#### **‚úÖ Prerrequisitos**

Antes de comenzar, aseg√∫rate de tener todo lo siguiente, tal como se explica en los documentos te√≥ricos:
* **Terraform instalado** en tu m√°quina local o en un Codespace de GitHub.
* Una **cuenta de AWS**.
* La **AWS CLI instalada**.
* Un **usuario IAM** con acceso program√°tico y permisos para EC2 (`AmazonEC2FullAccess`).
* Tus credenciales locales configuradas ejecutando `aws configure`.

---

### **üìã Instrucciones Paso a Paso**

#### **Paso 1: Preparar el Espacio de Trabajo**

1.  Crea una nueva carpeta para tu proyecto. Puedes llamarla `mi-primer-proyecto-tf`.
2.  Abre esa carpeta en tu editor de c√≥digo favorito (como Visual Studio Code).

#### **Paso 2: Definir el Proveedor (providers.tf)**

Crea un archivo llamado `providers.tf`. Este archivo le dir√° a Terraform que vamos a trabajar con AWS y qu√© versi√≥n del proveedor usar para garantizar la estabilidad.

```hcl
# providers.tf

terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0" # Usamos una versi√≥n reciente y estable
    }
  }
}

# Configuraci√≥n del proveedor. 
# La regi√≥n se tomar√° de una variable para mayor flexibilidad.
provider "aws" {
  region = var.aws_region
}
```

#### **Paso 3: Declarar las Variables (variables.tf)**
Crea un archivo llamado variables.tf. Aqu√≠ definiremos todos los par√°metros que queremos poder cambiar f√°cilmente sin modificar el c√≥digo principal. Esto hace tu configuraci√≥n reutilizable, como se explica en 05-variables.md.

```
# variables.tf

variable "aws_region" {
  description = "La regi√≥n de AWS donde se crear√°n los recursos."
  type        = string
  default     = "us-east-1"
}

variable "instance_type" {
  description = "El tipo de instancia EC2 a crear."
  type        = string
  default     = "t2.micro"
}

variable "instance_ami" {
  description = "El ID de la AMI (Amazon Machine Image) para la instancia. Debe ser de la regi√≥n seleccionada."
  type        = string
  # No tiene valor por defecto, por lo que Terraform preguntar√° por √©l.
}

variable "instance_name" {
  description = "El nombre que se le asignar√° a la instancia a trav√©s de una etiqueta."
  type        = string
  default     = "MiServidorWeb"
}
```

Nota para el alumno: La variable `instance_ami` es obligatoria. Para encontrar un ID de AMI v√°lido, ve a la consola de AWS EC2, secci√≥n "AMIs", y busca una AMI gratuita de Amazon Linux o Ubuntu en la regi√≥n que vas a usar (ej. `us-east-1`).

#### **Paso 4: Crear la Infraestructura (main.tf)**
Ahora, el coraz√≥n de nuestro proyecto. Crea un archivo main.tf para definir la m√°quina virtual (instancia EC2) que queremos crear. Observa c√≥mo usamos las variables con la sintaxis `var.nombre_de_la_variable`.

```
# main.tf

resource "aws_instance" "servidor_web" {
  ami           = var.instance_ami
  instance_type = var.instance_type

  tags = {
    Name = var.instance_name
  }
}
```
#### **Paso 5: Definir las Salidas (outputs.tf)**
Finalmente, queremos que Terraform nos muestre informaci√≥n √∫til despu√©s de crear la instancia. Crea un archivo outputs.tf para exponer la IP p√∫blica y el ID de la instancia.

```
# outputs.tf

output "instance_public_ip" {
  description = "La direcci√≥n IP p√∫blica de la instancia EC2 creada."
  value       = aws_instance.servidor_web.public_ip
}

output "instance_id" {
  description = "El ID de la instancia EC2 creada."
  value       = aws_instance.servidor_web.id
}
```
#### **üöÄ Ejecuci√≥n del Proyecto**
Abre una terminal en la carpeta de tu proyecto y sigue el flujo de trabajo de Terraform.

Inicializar: Descarga el proveedor de AWS.
```
terraform init
```

Validar: Comprueba que la sintaxis de tu c√≥digo es correcta.
```
terraform validate
```
Planificar: Previsualiza los cambios que Terraform va a realizar. Te pedir√° que introduzcas el valor para la variable `instance_ami`

```
terraform plan
```
Aplicar: Crea la infraestructura. Confirma escribiendo `yes` cuando se te pida.

```
terraform apply
```
